@page "/nuevo-conexion"
@page "/editar-conexion/{Id:int}"
@layout AdminLayout
@using Microsoft.AspNetCore.Authorization
@using SharedApp.Data
@using SharedApp.Models.Dtos
@attribute [Authorize]
@inject NavigationManager NavigationManager

<PageTitle>Formulario Conexion</PageTitle>

<EditForm Model="conexion" OnValidSubmit="RegistrarConexion" class="pt-4">
    <DataAnnotationsValidator />

    <div class="card border">
        <div class="card-body px-lg-5 pt-4">
            <h3 class="text-success text-center py-2">
                <strong>Conexión al origen de datos</strong>
            </h3>

            <hr style="background-color:aliceblue" />
            <div class="row">
                <div class="col-6">
                    <label class="col-form-label">Sistema</label>
                    <select class="form-control" @bind="conexion.IdONA">
                        <option value="">Seleccione una organización</option>
                        @if (listaOrganizaciones != null)
                        {
                            @foreach (var organizacion in listaOrganizaciones)
                            {
                                <option value="@organizacion.IdONA">@organizacion.RazonSocial</option>
                            }
                        }
                    </select>
                    <ValidationMessage For="(() => conexion.IdONA)" />
                </div>
                <div class="col-6">
                    <label class="col-form-label">Origen de Datos</label>
                    <select class="form-control" @onchange="CambiarSeleccionMotor" value="@conexion.OrigenDatos">
                        <option value="">Seleccionar Motor de Base Datos</option>
                        @foreach (var databaseType in Enum.GetValues(typeof(DatabaseType)))
                        {
                            <option value="@databaseType">@databaseType</option>
                        }
                    </select>
                    <ValidationMessage For="(() => conexion.OrigenDatos)" />
                </div>
            </div>
            <div class="form-row py-2">
                <label class="col-form-label">Nombre Base de Datos</label>
                <div class="col">
                    <InputText @bind-Value="conexion.BaseDatos" class="form-control" placeholder="BaseDatos..." />
                    <ValidationMessage For="(() => conexion.BaseDatos)" />
                </div>
            </div>

            <div class="form-row py-2">
                <label class="col-form-label">Host</label>
                <div class="col">
                    <InputText @bind-Value="conexion.Host" class="form-control" placeholder="Host..." />
                    <ValidationMessage For="(() => conexion.Host)" />
                </div>
            </div>

            <div class="form-row py-2">
                <label class="col-form-label">Puerto</label>
                <div class="col">
                    <InputNumber @bind-Value="conexion.Puerto"
                                 class="form-control"
                                 placeholder="Puerto..."
                                 oninput="if (this.value.length > 4) this.value = this.value.slice(0, 4);
                              this.value = this.value.replace(/[^0-9]/g, '');" />
                    <ValidationMessage For="(() => conexion.Puerto)" />
                </div>
            </div>

            <div class="form-row py-2">
                <div class="col-6">
                    <label class="col-form-label">Usuario</label>
                    <InputText @bind-Value="conexion.Usuario" class="form-control" placeholder="Usuario..." />
                    <ValidationMessage For="(() => conexion.Usuario)" />
                </div>

                <div class="col-6">
                    <label class="col-form-label">Contraseña</label>
                    <InputText @bind-Value="conexion.Contrasenia" class="form-control" placeholder="Contrasenia..." type="password" id="password" />
                    <ValidationMessage For="(() => conexion.Contrasenia)" />
                </div>
            </div>

           
            <div class="form-group py-2">
                <label class="col-form-label">Migración</label>
                <select class="form-control col-6" @bind="conexion.Migrar">
                    <option value="">Seleccione una opción</option>
                    <option value="S">SI</option>
                    <option value="N">NO</option>
                </select>
                <ValidationMessage For="(() => conexion.Migrar)" />
            </div>

            <div class="form-row py-2">
                <div class="col">
                    @foreach (var item in lista)
                    {
                        <Icon Name="IconName.CheckAll" Size="IconSize.x2" />
                        <label class="col-form-label">
                            @item.MostrarWeb
                        </label>
                    }
                </div>
            </div>

        </div>
    </div>
</EditForm>

<div class="py-2 d-flex justify-content-end gap-2">
    <Button Color="ButtonColor.Secondary" @onclick="Regresar">
        Regresar
    </Button>
    <Button @ref="saveButton" Color="ButtonColor.Success" @onclick="async () => await RegistrarConexion()">
        Guardar
    </Button>
</div>

@code {
    private void Regresar()
    {
        NavigationManager.NavigateTo("/conexion");
    }
}