@page "/nuevo-conexion"
@page "/editar-conexion/{Id:int}"
@layout AdminLayout
@using Microsoft.AspNetCore.Authorization
@using SharedApp.Data
@using SharedApp.Models.Dtos
@attribute [Authorize]

<PageTitle>Formulario Conexion</PageTitle>

<EditForm Model="conexion" OnValidSubmit="RegistrarConexion" class="pt-4">
    <DataAnnotationsValidator />

    <div class="card border">
        <div class="card-body px-lg-5 pt-4">
            <h3 class="text-success text-center py-2">
                <strong>Informaci칩n Principal</strong>
            </h3>

            <hr style="background-color:aliceblue" />
            <div class="row">
                <div class="col-6">
                    <label class="col-form-label">Organizaci칩n</label>
                    <select class="form-control" @bind="conexion.IdONA">
                        <option value="">Seleccione una organizaci칩n</option>
                        @if (listaOrganizaciones != null)
                        {
                            @foreach (var organizacion in listaOrganizaciones)
                            {
                                <option value="@organizacion.IdONA">@organizacion.RazonSocial</option>
                            }
                        }
                    </select>
                    <ValidationMessage For="(() => conexion.IdONA)" />
                </div>
                <div class="col-6">
                    <label class="col-form-label">Origen de Datos</label>
                    <select class="form-control" @onchange="CambiarSeleccionMotor" value="@conexion.OrigenDatos">
                        <option value="">Seleccionar Motor de Base Datos</option>
                        @foreach (var databaseType in Enum.GetValues(typeof(DatabaseType)))
                        {
                            <option value="@databaseType">@databaseType</option>
                        }
                    </select>
                    <ValidationMessage For="(() => conexion.OrigenDatos)" />
                </div>
            </div>
            <div class="form-row py-2">
                <label class="col-form-label">Base Datos</label>
                <div class="col">
                    <InputText @bind-Value="conexion.BaseDatos" class="form-control" placeholder="BaseDatos..." />
                    <ValidationMessage For="(() => conexion.BaseDatos)" />
                </div>
            </div>

            <div class="form-row py-2">
                <label class="col-form-label">Host</label>
                <div class="col">
                    <InputText @bind-Value="conexion.Host" class="form-control" placeholder="Host..." />
                    <ValidationMessage For="(() => conexion.Host)" />
                </div>
            </div>

            <div class="form-row py-2">
                <label class="col-form-label">Puerto</label>
                <div class="col">
                    <InputNumber @bind-Value="conexion.Puerto" class="form-control" placeholder="Puerto..." />
                    <ValidationMessage For="(() => conexion.Puerto)" />
                </div>
            </div>

            <div class="form-row py-2">
                <label class="col-form-label">Usuario</label>
                <div class="col">
                    <InputText @bind-Value="conexion.Usuario" class="form-control" placeholder="Usuario..." />
                    <ValidationMessage For="(() => conexion.Usuario)" />
                </div>
            </div>

            <div class="form-row py-2">
                <label class="col-form-label">Contrase침a</label>
                <div class="col">
                    <InputText @bind-Value="conexion.Contrasenia" class="form-control" placeholder="Contrasenia..." type="password" id="password" />
                    <ValidationMessage For="(() => conexion.Contrasenia)" />
                </div>
            </div>

            <div class="form-row py-2">
                <label class="col-form-label">Migracion</label>
                <div class="col">
                    <InputText @bind-Value="conexion.Migrar" class="form-control" placeholder="Migracion(S/N)" />
                    <ValidationMessage For="(() => conexion.Migrar)" />
                </div>
            </div>

            <div class="form-row py-2">
                <label class="col-form-label">Filtros</label>
                <div class="col">
                    <AutoComplete @bind-Value="homologacionName"
                                  TItem="HomologacionDto"
                                  DataProvider="VwHomologacionDataProvider"
                                  PropertyName="MostrarWeb"
                                  Placeholder="Buscar..."
                                  OnChanged="(HomologacionDto vwHomologacion) => OnAutoCompleteChanged(vwHomologacion)" />
                </div>
            </div>

            <div class="form-row py-2">
                <div class="col">
                    @foreach (var item in lista)
                    {
                        <Icon Name="IconName.CheckAll" Size="IconSize.x2" />
                        <label class="col-form-label">
                            @item.MostrarWeb
                        </label>
                    }
                </div>
            </div>

            <div class="py-2">
                <hr style="background-color:aliceblue" />
                <Button @ref="saveButton" Type="ButtonType.Submit" Color="ButtonColor.Success">
                    Guardar
                </Button>
            </div>
        </div>
    </div>
</EditForm>